{
	"info": {
      "_postman_id": "cookbook-debug-api-v1",
      "name": "Cookbook API - Debug Endpoints",
      "description": "Collection for testing Cookbook API debug endpoints (local/dev environments only)\n\n⚠️ **IMPORTANT**: These endpoints are ONLY available in local/dev environments, NOT in production.\n\nEndpoint: POST /debug/v1/recipes\n\nSupports:\n- URL or HTML text input\n- Multiple output formats (YAML, JSON)\n- HTML preprocessing strategies\n- Caching controls\n- Verbose metadata\n\nTo use this collection:\n1. Ensure your local server is running with profile `local` or `dev`\n2. Set the `baseUrl` variable to your local server (default: http://localhost:8080)\n3. Run the server with: `./gradlew :cookbook:bootRun --args='--spring.profiles.active=local'`",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "cookbook-api"
	},
	"item": [
		{
          "name": "Debug Transform - Basic",
			"item": [
				{
                  "name": "Transform from URL (YAML, Plain Text)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
                                  "pm.test(\"Content-Type is text/plain\", function () {",
                                  "    pm.response.to.have.header('Content-Type');",
                                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/plain');",
									"});",
									"",
                                  "pm.test(\"Response contains YAML metadata\", function () {",
                                  "    var responseText = pm.response.text();",
                                  "    pm.expect(responseText).to.include('metadata:');",
									"});",
									"",
                                  "pm.test(\"X-Is-Recipe header is present\", function () {",
                                  "    pm.response.to.have.header('X-Is-Recipe');",
                                  "});",
                                  "",
                                  "pm.test(\"X-Recipe-Title header present when recipe\", function () {",
                                  "    if (pm.response.headers.get('X-Is-Recipe') === 'true') {",
                                  "        pm.response.to.have.header('X-Recipe-Title');",
                                  "    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
                          "raw": "{\n  \"url\": \"https://www.allrecipes.com/recipe/24074/alysias-basic-meat-lasagna/\",\n  \"returnFormat\": \"yaml\",\n  \"cleanHtml\": \"auto\",\n  \"skipCache\": false,\n  \"verbose\": false\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
                          "raw": "{{baseUrl}}/debug/v1/recipes",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
                              "debug",
								"v1",
                              "recipes"
							]
						},
                      "description": "Transform recipe from URL, return as plain text YAML (legacy format)\n\n**Parameters**:\n- `url`: Recipe website URL\n- `returnFormat`: \"yaml\" (default) or \"json\"\n- `cleanHtml`: \"auto\" (default), \"structured\", \"section\", \"content\", \"raw\", \"disabled\"\n- `skipCache`: Skip recipe cache (default: false)\n- `verbose`: Include processing metadata (default: false)"
					},
					"response": []
				},
				{
                  "name": "Transform from HTML Text (YAML, Plain Text)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
                                  "pm.test(\"Content-Type is text/plain\", function () {",
                                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/plain');",
                                  "});",
                                  "",
                                  "pm.test(\"Response contains YAML structure\", function () {",
									"    var responseText = pm.response.text();",
									"    pm.expect(responseText).to.include('is_recipe:');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
                          "raw": "{\n  \"text\": \"<html><body><h1>Chocolate Chip Cookies</h1><h2>Ingredients</h2><ul><li>2 cups flour</li><li>1 cup butter</li><li>1 cup sugar</li><li>2 eggs</li><li>2 cups chocolate chips</li></ul><h2>Instructions</h2><ol><li>Preheat oven to 375°F</li><li>Mix butter and sugar</li><li>Add eggs and flour</li><li>Stir in chocolate chips</li><li>Bake for 10-12 minutes</li></ol></body></html>\",\n  \"returnFormat\": \"yaml\",\n  \"cleanHtml\": \"auto\",\n  \"skipCache\": false,\n  \"verbose\": false\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
                          "raw": "{{baseUrl}}/debug/v1/recipes",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
                              "debug",
								"v1",
                              "recipes"
							]
						},
                      "description": "Transform recipe from raw HTML text, return as plain text YAML\n\nUseful for:\n- Testing custom HTML\n- Testing edge cases\n- Testing specific HTML structures"
					},
					"response": []
				},
				{
					"name": "Transform Non-Recipe Content",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"X-Is-Recipe header is false\", function () {",
                                  "    pm.response.to.have.header('X-Is-Recipe');",
                                  "    pm.expect(pm.response.headers.get('X-Is-Recipe')).to.eql('false');",
									"});",
									"",
                                  "pm.test(\"Response contains is_recipe: false\", function () {",
									"    pm.expect(pm.response.text()).to.include('is_recipe: false');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
                          "raw": "{\n  \"text\": \"<html><body><h1>About Our Company</h1><p>We are a leading provider of kitchen appliances. Founded in 2020, we specialize in innovative cooking solutions.</p><p>Contact us at info@example.com</p></body></html>\",\n  \"returnFormat\": \"yaml\",\n  \"cleanHtml\": \"auto\",\n  \"verbose\": false\n}",
                          "options": {
                            "raw": {
                              "language": "json"
                            }
                          }
                        },
                      "url": {
                        "raw": "{{baseUrl}}/debug/v1/recipes",
                        "host": [
                          "{{baseUrl}}"
                        ],
                        "path": [
                          "debug",
                          "v1",
                          "recipes"
                        ]
                      },
                      "description": "Test Gemini's ability to detect non-recipe content.\n\nExpected behavior:\n- Returns `is_recipe: false`\n- `X-Is-Recipe` header = `false`\n- Minimal YAML response"
                    },
                  "response": []
                }
            ],
          "description": "Basic test scenarios with plain text YAML output"
        },
      {
        "name": "Debug Transform - JSON Format",
        "item": [
          {
            "name": "Transform with JSON Response",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "pm.test(\"Status code is 200\", function () {",
                    "    pm.response.to.have.status(200);",
                    "});",
                    "",
                    "pm.test(\"Content-Type is application/json\", function () {",
                    "    pm.response.to.have.header('Content-Type');",
                    "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                    "});",
                    "",
                    "pm.test(\"Response is valid JSON\", function () {",
                    "    pm.response.json();",
                    "});",
                    "",
                    "pm.test(\"Response contains isRecipe field\", function () {",
                    "    var jsonData = pm.response.json();",
                    "    pm.expect(jsonData).to.have.property('isRecipe');",
                    "});",
                    "",
                    "pm.test(\"Response contains recipeJson when isRecipe is true\", function () {",
                    "    var jsonData = pm.response.json();",
                    "    if (jsonData.isRecipe) {",
                    "        pm.expect(jsonData).to.have.property('recipeJson');",
                    "    }",
                    "});"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"url\": \"https://www.bbcgoodfood.com/recipes/classic-lasagne\",\n  \"returnFormat\": \"json\",\n  \"cleanHtml\": \"auto\",\n  \"skipCache\": false,\n  \"verbose\": false\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
                          "raw": "{{baseUrl}}/debug/v1/recipes",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
                              "debug",
								"v1",
                              "recipes"
							]
						},
              "description": "Transform recipe and return as JSON format.\n\nResponse includes:\n- `isRecipe`: boolean\n- `recipeJson`: Recipe object (if isRecipe=true)\n- Headers: X-Is-Recipe, X-Recipe-Title"
					},
					"response": []
				},
				{
                  "name": "Complex Recipe with JSON",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
                                  "pm.test(\"Recipe contains ingredients array\", function () {",
                                  "    var jsonData = pm.response.json();",
                                  "    if (jsonData.isRecipe && jsonData.recipeJson) {",
                                  "        pm.expect(jsonData.recipeJson).to.have.property('ingredients');",
                                  "        pm.expect(jsonData.recipeJson.ingredients).to.be.an('array');",
                                  "    }",
                                  "});",
                                  "",
                                  "pm.test(\"Recipe contains instructions array\", function () {",
                                  "    var jsonData = pm.response.json();",
                                  "    if (jsonData.isRecipe && jsonData.recipeJson) {",
                                  "        pm.expect(jsonData.recipeJson).to.have.property('instructions');",
                                  "        pm.expect(jsonData.recipeJson.instructions).to.be.an('array');",
                                  "    }",
                                  "});"
                                ],
                              "type": "text/javascript"
                            }
                        }
                    ],
                  "request": {
                    "method": "POST",
                    "header": [
                      {
                        "key": "Content-Type",
                        "value": "application/json"
                      }
                    ],
                    "body": {
                      "mode": "raw",
                      "raw": "{\n  \"text\": \"<html><body><article><h1>Homemade Lasagna</h1><div class='meta'><span>By Chef Mario</span><span>Servings: 8</span><span>Prep: 30 min</span><span>Cook: 1 hour</span></div><section><h2>Ingredients</h2><h3>For the sauce:</h3><ul><li>2 lbs ground beef</li><li>1 onion, diced</li><li>28 oz crushed tomatoes</li><li>2 cloves garlic, minced</li><li>1 tbsp Italian seasoning</li></ul><h3>For the layers:</h3><ul><li>12 lasagna noodles</li><li>15 oz ricotta cheese</li><li>2 cups mozzarella, shredded</li><li>1/2 cup parmesan, grated</li><li>2 eggs</li></ul></section><section><h2>Instructions</h2><ol><li>Brown the ground beef with onions and garlic in a large skillet over medium-high heat, about 8-10 minutes.</li><li>Add crushed tomatoes and Italian seasoning. Simmer for 20 minutes.</li><li>Cook lasagna noodles according to package directions. Drain and set aside.</li><li>Mix ricotta, eggs, and 1 cup mozzarella in a bowl.</li><li>Preheat oven to 375°F (190°C).</li><li>In a 9x13 baking dish, layer: sauce, noodles, ricotta mixture. Repeat twice.</li><li>Top with remaining mozzarella and parmesan.</li><li>Cover with foil and bake 25 minutes. Remove foil, bake 25 more minutes until golden.</li><li>Let rest 15 minutes before serving.</li></ol></section><section><h2>Notes</h2><p>Can be made ahead and refrigerated up to 2 days. Freezes well for up to 3 months.</p></section></article></body></html>\",\n  \"returnFormat\": \"json\",\n  \"cleanHtml\": \"auto\",\n  \"verbose\": false\n}",
                      "options": {
                        "raw": {
                          "language": "json"
                        }
                      }
                    },
                    "url": {
                      "raw": "{{baseUrl}}/debug/v1/recipes",
                      "host": [
                        "{{baseUrl}}"
                      ],
                      "path": [
                        "debug",
                        "v1",
                        "recipes"
                      ]
                    },
                    "description": "Test with complex recipe containing:\n- Multiple ingredient sections\n- Detailed instructions with timing\n- Recipe metadata (servings, prep/cook time)\n- Additional notes\n\nTests Gemini's ability to handle structured, complex recipes."
                  },
                  "response": []
                }
        ],
        "description": "Tests with JSON response format"
      },
      {
        "name": "Debug Transform - Advanced Options",
        "item": [
          {
            "name": "Verbose Mode with Processing Metadata",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "pm.test(\"Status code is 200\", function () {",
                    "    pm.response.to.have.status(200);",
                    "});",
                    "",
                    "pm.test(\"Content-Type is application/json (verbose=true forces JSON)\", function () {",
                    "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                    "});",
                    "",
                    "pm.test(\"Response contains metadata field\", function () {",
                    "    var jsonData = pm.response.json();",
                    "    pm.expect(jsonData).to.have.property('metadata');",
                    "});",
                    "",
                    "pm.test(\"Metadata contains processing details\", function () {",
                    "    var jsonData = pm.response.json();",
                    "    if (jsonData.metadata) {",
                    "        pm.expect(jsonData.metadata).to.have.property('totalProcessingTimeMs');",
                    "        pm.expect(jsonData.metadata).to.have.property('cacheHit');",
                    "        pm.expect(jsonData.metadata).to.have.property('htmlCleanupStrategy');",
                    "    }",
                    "});",
                    "",
                    "pm.test(\"Metadata includes HTML metrics\", function () {",
                    "    var jsonData = pm.response.json();",
                    "    if (jsonData.metadata) {",
                    "        pm.expect(jsonData.metadata).to.have.property('originalHtmlSize');",
                    "        pm.expect(jsonData.metadata).to.have.property('cleanedHtmlSize');",
                    "        pm.expect(jsonData.metadata).to.have.property('reductionRatio');",
                    "    }",
                    "});"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"url\": \"https://www.allrecipes.com/recipe/24074/alysias-basic-meat-lasagna/\",\n  \"returnFormat\": \"json\",\n  \"cleanHtml\": \"auto\",\n  \"skipCache\": false,\n  \"verbose\": true\n}",
                "options": {
                  "raw": {
                    "language": "json"
                  }
                }
              },
              "url": {
                "raw": "{{baseUrl}}/debug/v1/recipes",
                "host": [
                  "{{baseUrl}}"
                ],
                "path": [
                  "debug",
                  "v1",
                  "recipes"
                ]
              },
              "description": "Enable verbose mode to get detailed processing metadata.\n\n**When verbose=true**:\n- Always returns JSON format (overrides returnFormat)\n- Includes metadata object with:\n  - `totalProcessingTimeMs`: Total request processing time\n  - `cacheHit`: Whether recipe was retrieved from cache\n  - `contentHash`: Hash of input content\n  - `htmlCleanupStrategy`: Strategy used for HTML preprocessing\n  - `originalHtmlSize`: Size before cleaning\n  - `cleanedHtmlSize`: Size after cleaning\n  - `reductionRatio`: Compression ratio\n  - `transformationTimeMs`: Time spent in Gemini API\n  - `validationPassed`: Whether recipe passed validation"
            },
            "response": []
          },
          {
            "name": "Skip Cache - Force Fresh Transformation",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "pm.test(\"Status code is 200\", function () {",
                    "    pm.response.to.have.status(200);",
                    "});",
                    "",
                    "pm.test(\"Verbose metadata shows cache was skipped\", function () {",
                    "    var jsonData = pm.response.json();",
                    "    if (jsonData.metadata) {",
                    "        pm.expect(jsonData.metadata.cacheHit).to.equal(false);",
                    "    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
                          "raw": "{\n  \"text\": \"<h1>Quick Pizza Recipe</h1><p>Ingredients: dough, sauce, cheese</p><p>Instructions: Mix, top, bake at 450F for 12 minutes</p>\",\n  \"returnFormat\": \"json\",\n  \"cleanHtml\": \"auto\",\n  \"skipCache\": true,\n  \"verbose\": true\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
                          "raw": "{{baseUrl}}/debug/v1/recipes",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
                              "debug",
								"v1",
                              "recipes"
							]
						},
                      "description": "Set `skipCache: true` to bypass recipe cache and force fresh transformation.\n\nUseful for:\n- Testing after Gemini model updates\n- Re-extracting previously cached recipes\n- Debugging extraction issues"
					},
					"response": []
				},
				{
                  "name": "Different HTML Cleaning Strategies",
                  "event": [
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "});",
                          "",
                          "pm.test(\"Metadata shows cleanup strategy\", function () {",
                          "    var jsonData = pm.response.json();",
                          "    if (jsonData.metadata) {",
                          "        pm.expect(jsonData.metadata).to.have.property('htmlCleanupStrategy');",
                          "        var validStrategies = ['AUTO', 'STRUCTURED_DATA', 'SECTION_BASED', 'CONTENT_FILTER', 'DISABLED'];",
                          "        pm.expect(validStrategies).to.include(jsonData.metadata.htmlCleanupStrategy);",
                          "    }",
                          "});",
                          "",
                          "pm.test(\"HTML reduction metrics present\", function () {",
                          "    var jsonData = pm.response.json();",
                          "    if (jsonData.metadata) {",
                          "        pm.expect(jsonData.metadata.originalHtmlSize).to.be.greaterThan(0);",
                          "        pm.expect(jsonData.metadata.cleanedHtmlSize).to.be.greaterThan(0);",
                          "        pm.expect(jsonData.metadata.reductionRatio).to.be.within(0, 1);",
                          "    }",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "method": "POST",
                    "header": [
                      {
                        "key": "Content-Type",
                        "value": "application/json"
                      }
                    ],
                    "body": {
                      "mode": "raw",
                      "raw": "{\n  \"url\": \"https://www.bbcgoodfood.com/recipes/classic-lasagne\",\n  \"returnFormat\": \"json\",\n  \"cleanHtml\": \"auto\",\n  \"skipCache\": true,\n  \"verbose\": true\n}",
                      "options": {
                        "raw": {
                          "language": "json"
                        }
                      }
                    },
                    "url": {
                      "raw": "{{baseUrl}}/debug/v1/recipes",
                      "host": [
                        "{{baseUrl}}"
                      ],
                      "path": [
                        "debug",
                        "v1",
                        "recipes"
                      ]
                    },
                    "description": "Test different HTML cleaning strategies.\n\n**Available strategies** (cleanHtml parameter):\n- `auto` (default): Cascade through strategies\n- `raw`: No preprocessing\n- `disabled`: Same as raw\n- `structured`: Use structured data extraction\n- `section`: Use section-based extraction\n- `content`: Use content filtering\n\nVerbose mode shows which strategy was used and HTML size reduction."
                  },
                  "response": []
                }
        ],
        "description": "Advanced testing with caching, verbose metadata, and strategy selection"
      },
      {
        "name": "Error Handling",
        "item": [
          {
					"name": "Error - Missing Both URL and Text",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Error message indicates missing fields\", function () {",
                                  "    var jsonData = pm.response.json();",
                                  "    pm.expect(jsonData.error).to.include(\"Either 'url' or 'text' field is required\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
                          "raw": "{\n  \"returnFormat\": \"json\",\n  \"cleanHtml\": \"auto\",\n  \"verbose\": false\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
                          "raw": "{{baseUrl}}/debug/v1/recipes",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
                              "debug",
								"v1",
                              "recipes"
							]
						},
						"description": "Test validation that either URL or text is required.\n\nExpected behavior:\n- Returns 400 Bad Request\n- Error message indicates missing required fields"
					},
					"response": []
          },
          {
            "name": "Error with Verbose Mode",
            "event": [
              {
                "listen": "test",
                "script": {
                  "exec": [
                    "pm.test(\"Status code is 500\", function () {",
                    "    pm.response.to.have.status(500);",
                    "});",
                    "",
                    "pm.test(\"Response is JSON\", function () {",
                    "    pm.response.json();",
                    "});",
                    "",
                    "pm.test(\"Error response includes metadata\", function () {",
                    "    var jsonData = pm.response.json();",
                    "    pm.expect(jsonData).to.have.property('metadata');",
                    "    pm.expect(jsonData.metadata).to.have.property('validationError');",
                    "});"
                  ],
                  "type": "text/javascript"
                }
              }
            ],
            "request": {
              "method": "POST",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": {
                "mode": "raw",
                "raw": "{\n  \"url\": \"https://invalid-url-that-wont-load-abcdef123456.com\",\n  \"returnFormat\": \"json\",\n  \"cleanHtml\": \"auto\",\n  \"verbose\": true\n}",
                "options": {
                  "raw": {
                    "language": "json"
                  }
                }
              },
              "url": {
                "raw": "{{baseUrl}}/debug/v1/recipes",
                "host": [
                  "{{baseUrl}}"
                ],
                "path": [
                  "debug",
                  "v1",
                  "recipes"
                ]
              },
              "description": "When an error occurs with `verbose: true`, the response includes error metadata:\n- `validationPassed: false`\n- `validationError`: Error message\n- `totalProcessingTimeMs`: Time before error occurred\n\nUseful for debugging processing issues."
            },
            "response": []
          }
        ],
        "description": "Error scenarios and edge cases"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080",
			"type": "string"
		}
	]
}